on:
  push:
    branches:
      - '**'  # Запуск при любом пуше, можно ограничить конкретной веткой

jobs:
  build-and-run:
    runs-on: [self-hosted, test-client]

    env:
      BRANCHE: ${{ github.ref_name }}  # Название ветки
      MODE: client
      START: ClientCLI

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Run Docker Compose
        run: |
          # В случае необходимости, можно экспортировать переменные окружения внутри скрипта
          echo "BRANCHE=${BRANCHE}"
          echo "MODE=${MODE}"
          echo "START=${START}"
          
          # Запуск docker-compose с нужным файлом
          docker-compose -f ./dockers/ubuntu/docker-compose.yml up -d

          # Удаление контейнера по имени
          docker rm -f ubuntu

          # Удаление образа
          docker rmi test_ubunt
